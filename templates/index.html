{% extends 'base.html' %}

{% block content %}
<h2 class="mb-4">Ma BibliothÃ¨que</h2>

{% if mangas %}
<div class="row g-3">
    {% for m in mangas %}
    <div class="col-12 col-sm-6 col-lg-4 col-xl-3">
        <div class="card h-100 shadow-sm manga-card">
            <img src="{{ m.image_couverture or 'https://via.placeholder.com/300x420?text=Manga' }}" 
                 class="card-img-top object-cover" 
                 alt="{{ m.titre }}"
                 onerror="this.src='https://via.placeholder.com/300x420?text=Erreur'">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title">{{ m.titre }}</h5>
                <p class="card-text small text-muted mb-2">
                    <span class="badge bg-secondary">{{ m.source or 'Inconnu' }}</span>
                </p>
                {% if m.resume %}
                <p class="card-text small mb-3">
                    {{ m.resume[:150] }}{% if m.resume|length > 150 %}...{% endif %}
                </p>
                {% endif %}
                
                <div class="mt-auto">
                    <p class="mb-2"><strong>Dernier chapitre :</strong> {{ m.dernier_chapitre }}</p>
                    
                    <form action="{{ url_for('update', manga_id=m.id) }}" method="post" class="d-flex gap-2 mb-2">
                        <input type="text" name="chapitre" class="form-control form-control-sm" 
                               placeholder="NÂ° chapitre" required>
                        <button class="btn btn-primary btn-sm" type="submit">ğŸ“</button>
                    </form>
                    
                    <div class="d-flex gap-2 mb-2">
                        <form action="{{ url_for('refresh', manga_id=m.id) }}" method="post" class="flex-fill">
                            <button class="btn btn-outline-secondary btn-sm w-100" type="submit" 
                                    title="RafraÃ®chir depuis le site">ğŸ”„</button>
                        </form>
                        <a href="{{ m.url }}" target="_blank" class="btn btn-outline-dark btn-sm flex-fill" 
                           title="Ouvrir l'URL">ğŸ”—</a>
                        <a href="{{ url_for('edit', manga_id=m.id) }}" class="btn btn-outline-info btn-sm flex-fill"
                           title="Ã‰diter">âœï¸</a>
                    </div>
                    
                    <form action="{{ url_for('delete', manga_id=m.id) }}" method="post" 
                          onsubmit="return confirm('Supprimer {{ m.titre }} ?');">
                        <button class="btn btn-outline-danger btn-sm w-100" type="submit">ğŸ—‘ï¸ Supprimer</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="text-center py-5">
    <div class="mb-4">
        <svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="20" y="10" width="60" height="80" rx="2" fill="#e9ecef"/>
            <rect x="30" y="20" width="40" height="4" fill="#dee2e6"/>
            <rect x="30" y="30" width="35" height="3" fill="#dee2e6"/>
            <rect x="30" y="37" width="30" height="3" fill="#dee2e6"/>
        </svg>
    </div>
    <p class="lead">Ta bibliothÃ¨que est vide</p>
    <p class="text-muted">Commence par ajouter ton premier manga</p>
    <a href="{{ url_for('add') }}" class="btn btn-success btn-lg">â• Ajouter un manga</a>
</div>
{% endif %}
{% endblock %}